# Example configuration for mock cluster analysis WITH dipole
# This config allows dipole to vary (anisotropy model)
# Paths will be updated by the script to use absolute paths

root_main = "./"
python_exec = "python"
machine = "local"

[inference]
model = "Clusters_DistMarg"
shared_params = "none"
num_warmup = 1000
num_samples = 1000
num_chains = 1
chain_method = "parallel"
seed = 44
compute_log_density = true
compute_evidence = false
track_log_density_per_sample = true  # REQUIRED for cluster removal analysis
num_chains_harmonic = 10
skip_if_exists = false

[pv_model]
#kind = "Vext"
kind = "precomputed_los_Carrick2015"
galaxy_bias = "linear"
which_Vext = "constant"
Vext_per_pix_nside = 1
which_A = "constant"
A_per_pix_nside = 1

r_limits_malmquist = [0.1, 1301]
num_points_malmquist = 1301
los_decay_scale = 5.0

[model]
Om = 0.3
use_MNR = true
marginalize_eta = true

[model.eta_grid]
k_sigma = 5
n_grid = 31

[model.priors.h]
dist = "delta"
value = 1.0

[model.priors.b1]
dist = "delta"
value = 4.0

[model.priors.beta]
dist = "delta"
value = 0.43

[model.priors.alpha]
dist = "uniform"
low = 0.0
high = 10.0

[model.priors.alpha_low]
dist = "uniform"
low = 0.0
high = 10.0

[model.priors.alpha_high]
dist = "uniform"
low = 0.0
high = 4.0

[model.priors.log_rho_t]
dist = "uniform"
low = -10.0
high = 10.0

[model.priors.sigma_int]
#dist = "delta"
#value = 0.10
dist = "jeffreys"
low = 0.01
high = 0.2

[model.priors.CL_A]
dist = "uniform"
low = 1.0
high = 3.0

[model.priors.CL_B]
dist = "uniform"
low = 2.0
high = 3.0

[model.priors.CL_C]
dist = "uniform"
low = -2.0
high = 2.0

[model.priors.sigma_v]
#dist = "delta"
#value = 350.0
dist = "jeffreys"
low = 300.0
high = 600.0

# Still no bulk flow Vext
[model.priors.Vext]
dist = "delta"
value = [0.0, 0.0, 0.0]

[model.priors.Vext_quad]
dist = "delta"
value = [
    [0, 0],
    [0, 0],
    [0, 0],
]

# ZEROPOINT DIPOLE - allow to vary (this is the dipole anisotropy)
[model.priors.zeropoint_dipole]
dist = "vector_uniform_fixed"
low = 0.0
high = 0.1

[model.priors.zeropoint_quad]
dist = "delta"
value = [
    [0, 0],
    [0, 0],
    [0, 0],
]

[model.priors.dH0]
dist = "delta"
value = [0, 0, 0]

[model.priors.R_dist_emp]
dist = "uniform"
low = 80.0
high = 130.0
#dist = "delta"
#value = 120.0

[model.priors.p_dist_emp]
dist = "delta"
value = 2.0

#dist = "normal"
#loc = 2.0
#scale = 0.1

[model.priors.n_dist_emp]
dist = "delta"
value = 1.1

[model.priors.Vext_sigma]
dist = "uniform"
low = 0.0
high = 1000.0

[io]
root_output = "results/mocks"
# catalogue_name will be set automatically by the script to Clusters_mock_{rank}
catalogue_name = "Clusters_mock_0"
fname_output = "results/mocks/dipole.hdf5"

# This section will be updated by the script
[io.Clusters_mock]
root = "PLACEHOLDER_MOCK_DIR"

[io.Clusters]
which_relation = "YT"
zcmb_max = 0.35

